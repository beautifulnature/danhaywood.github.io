---
author: danhaywood
comments: true
date: 2011-11-23 00:33:15+00:00
layout: post
slug: jqtouch-and-restful-objects-apache-isis
title: jQTouch and Restful Objects (Apache Isis)
wordpress_id: 833
tags:
- jqtouch
- restful objects
---

I've started looking into using jQTouch to build a custom UI against a Restful Objects back-end hosted in UI. Â These are my own notes; apologies but I haven't annotated them...

<!-- more -->

The domain object model you need to understand for this example is really simple; just a finder on a repository:

[sourcecode language="java"]
@Named("Customers")
public interface Customers {

    @QueryOnly
    public Customer findByEmail(
        @Named("Email")
        String email);
    ...
}
[/sourcecode]

And as you can probably imagine, one of the properties of Customer is an email address:

[sourcecode language="java"]
public class Customer extends AbstractDomainObject {
    ...
    //  {% raw } {{ {% endraw %} Email (property)
    private String email;

    @MemberOrder(sequence = "4.0")
    public String getEmail() {
        return email;
    }

    public void setEmail(final String email) {
        this.email = email;
    }
    // }}
    ...
}
[/sourcecode]

Next, I downloaded the jQTouch and unzipped into src/main/webapp of my viewer-json module (as generated by the Isis archetype).

Hopping into src/main/webapp/demo, I copied "skel" to a new directory, "webshop".

The top of src/main/webapp/demo/webshop/index.html is all boilerplate:

[sourcecode language="html"]
<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />

        <title>Webshop on Isis</title>
        <style type="text/css" media="screen">@import "../../jqtouch/jqtouch.css";</style>
        <style type="text/css" media="screen">@import "../../themes/jqt/theme.css";</style>
        <script src="../../jqtouch/jquery-1.4.2.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../jqtouch/jqtouch.js" type="application/x-javascript" charset="utf-8"></script>
        <script type="text/javascript" charset="utf-8">
            var jQT = new $.jQTouch({
                icon: 'jqtouch.png',
                addGlossToIcon: false,
                startupScreen: 'jqt_startup.png',
                statusBar: 'black'
            });

            $(function(){
                // Custom Javascript (onReady)
            });
        </script>
        <style type="text/css" media="screen">
        </style>

        <script src="webshop.js" type="application/x-javascript" charset="utf-8"></script>
    </head>
    <body>
        <div id="jqt">
        </div>
    </body>
</html>
[/sourcecode]

This is pretty much what the same as skel/index.html; the only addition is that script include of webshop.js.

The skeleton for the webshop.js script itself is:

[sourcecode language="javascript"]
(function($){

$(function(){
    ... this is where our functions go ...
});

})(jQuery);
[/sourcecode]

I broke the app itself down into two pages. The first shows the finders for Customer:

[sourcecode language="html"]
        <div id="jqt">
            <div id="customers" class="current">
                <div class="toolbar">
                    <h1>Customers</h1>
                    <a href="#" class="back">Back</a>
                </div>
                <h2>Find by Email</h2>
                <div class="findByEmail">
                    <form>
                        <ul class="edit rounded">
                            <li class="email">
                                <input type="email" name="email" placeholder="email@address.com"></input>
                                <span style="display: inline; font-size: 75%; color:rgb(255,127,0)"/>
                            </li>
                        </ul>
                        <a style="margin:0 10px;color:rgba(0,0,0,.9)" href="#" class="submit whiteButton">Submit</a>
                        <a style="display:none" href="#customer" class="onsuccess">dummy text</a>
                    </form>
                </div>
            </div>
            ...
        </div>
[/sourcecode]

In webshop.js I then have a binding onto this form:

[sourcecode language="javascript"]
     $("#customers .findByEmail form").submit(function() {
         var email = $("#customers .findByEmail .email input").val()
         if (!email) {
             $("#customers .findByEmail .email span").text("Enter email address").show().fadeOut(1000);
             return false;
         }

         $.get("/services/customers/actions/findByEmail/invoke?email=" + email,
            function(data) {
                $("#customer").data("object", data.result)
                $("#customers .findByEmail .onsuccess").click();
            }
        );

         return false;
    });
    ...
[/sourcecode]

When the user submits the form, we validate the email address and then call the REST API to get the customer. This is the bound to the target #customer div as a data element "object".

The #customer div, which will show the customer, looks like this:

[sourcecode language="html"]
        <div id="jqt">
            ...
            <div id="customer">
                <div class="toolbar">
                    <h1>No Customer</h1>
                    <a href="#" class="back">Back</a>
                </div>
                <ul class="rounded members">

                </ul>
            </div>
        </div>
[/sourcecode]

And the javascript to render the customer is:

[sourcecode language="javascript"]
    ...
    $('#customer').bind('pageAnimationStart', function (e, info) {
      var cust = $("#customer").data("object")
      $("h1").text(cust.title)
      var email = $.each(cust.members, function(index, member) {
        if(member.memberType == 'property') {
            $(".members").append('<li><span>' + member.id + ': </span><span>' + member.value + '</span></li>')
        }
       } );
      $(".email").text(email)

    });
[/sourcecode]

There's plenty more that could be done to tidy this up, but that's hopefully gives you an idea...
